window.repositoryObject = {"parameters":[{"name":"p_ini_id","description":null,"mode":"IN","data_type":"int(10, 0)","custom_fields":{},"linked_terms":[]}],"parameters_custom_fields":[],"dependencies":{"uses":[],"used_by":[]},"object_id":"p26","name":"SP_set_Domain_Core","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"Cleverads","id":"d6"}},{"field":"Name","value":"SP_set_Domain_Core"},{"field":"Type","value":"Procedure"}],"script":"BEGIN\r\nDECLARE v_ndd_id         BIGINT ;\r\nDECLARE v_domain_id      INTEGER;\r\nDECLARE v_Domain         VARCHAR(250);\r\nDECLARE v_domain_core    VARCHAR(250);\r\nDECLARE v_first_hit_at   DATE;\r\nDECLARE v_start          DATE;\r\nDECLARE v_count          INTEGER;\r\nDECLARE finished         INTEGER;\r\n\r\n\r\nDECLARE c_dpv \r\n\t\tCURSOR FOR \r\n\t\tSELECT ndd.Domain,get_domain(ndd.Domain) core, ndd.id\r\n\t\tFROM neria_download_stats_detail ndd\r\n\t\tWHERE ndd.id >= p_ini_id\r\n\t\tAND domain_core IS NULL\r\n\t\tORDER BY id;\r\n\t\t\t\r\nDECLARE c_dom\r\n\t\tCURSOR FOR \r\n\t\t   SELECT id\r\n\t\t   FROM domains d\r\n\t\t   WHERE d.name = v_Domain;\r\n\r\n\t\r\nDECLARE CONTINUE HANDLER \r\n      FOR NOT FOUND SET finished = 1;\r\n        \r\nSET finished = 0;\r\nSET v_count  = 0;\r\nSET v_start  = sysdate();\r\n\r\n\r\n\tOPEN c_dpv ;\r\n\tB: LOOP\r\n\t   set finished = 0;\r\n\t   FETCH c_dpv  INTO  v_domain,v_domain_core,v_ndd_id;\r\n\t\tIF finished = 1 THEN \r\n\t \t   close c_dpv;\r\n\t\t\tLEAVE B;\r\n\t\tEND IF;\r\n\r\n      set finished = 0;\r\n\t\tOPEN c_dom;\r\n\t\tFETCH c_dom  INTO v_domain_id;\r\n\t\tif finished = 1 then\r\n\t\t\tSET v_domain_id = NULL;\r\n\t\tEND if;\r\n\t\tclose c_dom;\r\n\t\t\r\n\t\tSET v_count = v_count +1;\r\n\t\tUPDATE control_execution \r\n\t\tSET last_key = v_domain,\r\n\t\t    COUNT    = v_count,\r\n\t\t    START    = v_start,\r\n\t\t    END      = SYSDATE(),\r\n\t\t    info     = CONCAT('infor: ',v_ndd_id)\r\n\t\tWHERE id = 9;\r\n\t\t\r\n\t\tUPDATE neria_download_stats_detail\r\n\t\tSET domain_core = v_domain_core,\r\n\t\t    domain_id   = v_domain_id\r\n\t\tWHERE id = v_ndd_id;\r\n\t\t\r\n\t\t\r\n\tEND LOOP B;\r\n \tCOMMIT;\r\nEND","imported_at":"2024-06-28 17:00"};