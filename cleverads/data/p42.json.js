window.repositoryObject = {"parameters":[{"name":"oldUser","description":null,"mode":"IN","data_type":"int(10, 0)","custom_fields":{},"linked_terms":[]},{"name":"newUser","description":null,"mode":"IN","data_type":"int(10, 0)","custom_fields":{},"linked_terms":[]}],"parameters_custom_fields":[],"dependencies":{"uses":[],"used_by":[]},"object_id":"p42","name":"v1_transfer_lead_owner","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"Cleverads","id":"d6"}},{"field":"Name","value":"v1_transfer_lead_owner"},{"field":"Type","value":"Procedure"}],"script":"BEGIN\r\nDECLARE v_lead_id INTEGER;\r\nDECLARE finished INTEGER DEFAULT 0;\r\n\r\n\t\r\n\tDECLARE c_ld \r\n\t\tCURSOR FOR \r\n\t\t   SELECT id\r\n\t\t   FROM leads l\r\n\t\t   WHERE l.owner_user_id = oldUser;\r\n\t\t   \r\n\t\r\n\tDECLARE CONTINUE HANDLER \r\n        FOR NOT FOUND SET finished = 1;\r\n        \r\nSTART TRANSACTION;\r\nOPEN c_ld;\r\nB: LOOP\r\n\tFETCH c_ld INTO  v_lead_id;\r\n\t\tIF finished = 1 THEN \r\n\t\t\tLEAVE B;\r\n\t\tEND IF;\r\n\t\t\r\n\t\t\r\n\t\tUPDATE leads l\r\n\t\tSET l.owner_user_id = newUser,\r\n\t\t    l.updated_user_id = 1,\r\n\t\t    l.updated_at = SYSDATE()\r\n\t\tWHERE l.id = v_lead_id;\r\n\t\t\r\n\t\t\r\n\t\tINSERT INTO leads_owners_logs (lead_id,transfer_user_id,old_owner_user_id,new_owner_user_id,transferred_at)\r\n\t\t      VALUES (v_lead_id,1,oldUser,newUser,SYSDATE());\r\n\t\t      \r\n\t\t\r\n\t\tUPDATE domains d\r\n\t\tSET    d.user_blocked_id = newUser,\r\n\t\t       d.updated_user_id =  1,\r\n\t\t       d.updated_at = SYSDATE()\r\n\t\tWHERE  d.lead_blocked_id = v_lead_id\r\n\t\tAND    d.user_blocked_id = oldUser;\r\n\t\t\r\n\t\t\r\n\tEND LOOP B;\r\n\tCOMMIT;\r\nEND","imported_at":"2024-06-28 17:00"};